<header class="site-header">
<nav>
  <ol class="breadcrumb">
  	<li class="breadcrumb-item"><img style="max-height:1.4em;" src=" data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAyCAYAAACqNX6+AAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV/TSlUqgnYQcchQnSyIFXHUKhShQqgVWnUwufQLmjQkKS6OgmvBwY/FqoOLs64OroIg+AHi5Oik6CIl/q8ptIjx4Lgf7+497t4BQr3MNCswAWi6baYScTGTXRWDrwhgAD2IISIzy5iTpCQ8x9c9fHy9i/Is73N/jj41ZzHAJxLPMsO0iTeIpzdtg/M+cZgVZZX4nHjcpAsSP3JdcfmNc6HJAs8Mm+nUPHGYWCx0sNLBrGhqxFPEEVXTKV/IuKxy3uKslausdU/+wlBOX1nmOs0RJLCIJUgQoaCKEsqwEaVVJ8VCivbjHv7hpl8il0KuEhg5FlCBBrnpB/+D391a+dikmxSKA10vjvMxCgR3gUbNcb6PHadxAvifgSu97a/UgZlP0mttLXIE9G8DF9dtTdkDLneAoSdDNuWm5Kcp5PPA+xl9UxYYvAV619zeWvs4fQDS1FXyBjg4BMYKlL3u8e7uzt7+PdPq7weQ03KzT89SWQAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAN1wAADdcBQiibeAAAAAd0SU1FB+QEEgk2DMHqLDEAAAtmSURBVHja7ZxpbBzlGcd/M3vO2rv2Zr121ji2A9iOEoeQkBScg9oJlCYBIaqK0g9pUUqFVAlCQGpRRUP7qS2VilALfCoNoioFtaUqJLSVAjk4WmjS0AItNYU4B8YJjuNjkx3v1Q/zLAyrPWZ2Z5yo6l8aEc++5/O8z/k+A/wfFyRa53i+LmCtg+MF5HEKa2SNc84DVf7YDAzO4eRB4NfAKgcJuMahsVbK2oJzSI/PCg/wyIsZQAeuBE4BKZcX0AKcBb4I/AsYq2MsL7AAyAPHgVwdYy0FvgM8B7wFjLtMh2bgGmAUeA84bf5xg+m0XebyQvqAbwINwO+ARXWMNShM8dYp5X2ylgZZW5/LNFhqUtsF2n+ssgBmAT/wMnAG+LxJgtxCEvgK8ABwSQ39VXky8qhFe7KKi4EfAV+VNbkJj9B2CnhJaD5bruHVRapgI9DhooQUMA94VlSPHawrMuYBeWcHC2TumOmdWxJyEbBJaFvA1ea/zacpWyQRGeB50fcDLp+a08BtwCNAwmIfRU6XbnqnyzvF4hjzZc7b5sBeDIgntVtoaxaETKXTcmmJ9zHgeiDkkoQU0CGntcXCGKvLrCckv1VDTOYqpQGclBBNaBcr8dulQGexDjbjWHEDwbh4Hle5bOyOA3cCPxcPpBJC4qkV46yFg9ME7JS5jru4n145HM+VkcBO4GglhhTEvpwP/oK4lRtsqAW7eB+4RwjWWKbNZ4DXKozxmrQphUbgcZnjfReZsUFc8T0VYjHdqucyZOF0bgbiDqssM/qB34rIF+NaC3NcW0Z9/EbGroR6VFaL0KaalA7Z8Qg3WGx3FbDcJYYArACeLvKklotXVg3zpL/ZA3sKuMJC31oZcrkNB2hDOWkohbeAxRYG/bNE2cWunFM4BDwIPGYaP1Yc0Vbw3OaZXPifAQ8BB11Yp1docAp41UL7xUJjWxiy0dYDXAd0Oywh5mh8J7AMaLPRr0367LS5HzsS0iV79zhB20o6zIq3Yo5h/giEcTaLW8Be4EngB8BJG/1OAt8HfgW86MK61gIR2XvWYp9y3mFVhryOkWy0g3/Ic4Mwx0mMiPv4kI0+DwG7gCMOr6VR9vim7NcOrhTa2mZIrsa80KQEXMuBJQ4SoQN4WHT0Axba/1Bs3MMOp38Wi2PwLEbOzy5UKmSkqxH8DdHBtWA/cE7cT7VOIlwKvCv/fhIjZf/dCu3vB/4N/FL+frdMBsIOFIxUuQ7sq3GMZUJTamXIR2VCfqt4Txa/0aYxLkZ3kdp5TNb2rTIG+bR4VQUcseFwlHMONgMHgP/UMU5M1l0zQxCxbKpjEbOixzsqRM/VvJiREu9/KpHwnaZ3d8h/f1LGBtVyLbsKI8f3nNXIukK6pqqKs8KQQ0UBVq04KETZhL3r0R5guMxvDwBRjGzt1+QElrMvwzKWVQRlrceAvzqw/xVCy6oBjVX96QTGMFL6t1r029uBD6q0+Z6kWBTgpiptP7A4pkcIuFOk0AlYoqFVY/s3h6QE2eArGLd01YK1xcDbVdrcJKf4KPCFKm3ftpCBGJS1veIgM1YIDR1jyISoBicxLP749WXGbpVURCVslCj5LnmuFTVTLVgsVfbULGs5WEFF1oqo0NBRLMPaxVEtqZO1GJf+ZlTL6A6Jt+UpUjWPAeur9C0ee2lRhsHJC6oWO6GDnfjgDdyrRnmJTxdWRKmcQFwtRvz2opRFVt5tpXKd1mmZQ5U5J2UNbuCyarFHLUbdrP/dwjHgQzm980xBXTGuALZhVKukS/yeFoY8gVFfdrCMx/dlUSN7yozjFGzRzG4E/TrOVRtShpgvy0EplUfrB74tXppeJfa5VdouLZNPKpQ8ucmMVZXyVk5hvQNjVEq/X2OKam/gkxvDXoxCtkYb8zRKn4I90GTMlqK5SkX7feeDVrVcKo1hlM986AKzNcl/wSeFFYOyzjtETc3YGG8Go/jtCYneszJmQY2cLZrTSczH3lVBTSoLjJuuJS5J32rx/836d1hc2sfF+NrFlPS9CyPhaNbpr2KtZKgWLMFIz7vOkII3ozq8Ab/oczPB2oBHJTWyGyPBZ8f1LtST7Rav7FE5uWaGp2VuJ6Fi/cLKEQSpr5qxlA1ZX8TkQiHbghIG2UrWYEUJx6BU2ahaQtfXa0MGqPFzhlpPeQpnv5/wYlzaFC5umiTA2ybusBl/ETu2EfCVGMsnscVJaVvsWm/DKMQrZLAL83odPrAp5hh9GMXDTkjIZ03EbQSeofonCqowxZxS75R3qoX5zR6bj09/ylCPhFxUj3TVcyrewagtOuGAvvWILtcwMqz3Y9wKVrINUZl7UE54XvZzCCM5OEH5Aup3gB0y1xbxsgqfMuTq3M8iylcrusqQgnH3UqF6u0oEGxX1Mqqq6pDP59ve2tr6+3A4nBkZGflcMpmMSuqh1+PxdKmqOq2qakDX9WQkEpmYmpoqRfBVkUgkNjU1FQ0EAg2ZTOacqqrhdDp9Qpj8hqZpZxYuXHh8enr6+ZMnTz6dTqd/nMvlcsCXgD/UkZHw1mvM673n8IvhPFBJn0aj0ctnZ2fPAY2BQCCTz+ebz549u1nX9UcSiUTn6Ojon6LR6OOpVGo0lUp1a5qWSKVSxzRNex04HA6HRyYnJ48MDg6ye/duWwu88cYb2b9/P8FgsHtmZqZLUZRlyWRyZTAY7NR1fczn8x3RNK19YmJiSyKRuG50dHQkEAh8IxQK7VJVdTyVSgWBGb/fH5yYmDhcxTasE7s1y3lEqWj04kQisaqpqWl1MBjs37Jli7Jv3z7y+Tz5fB6Mb0Du6evr6w+Hw6u9Xu8uv9+/NxQK3d7e3r6gs7Pz47ZuPZ2dnbS3t3f4/f6v+/3+F7xe765IJLK6r6+vH6MQO1Fou2fPHm655RY1EAj0R6PRgba2tisURbnEpSxG3egGFgIEg8HeaDS6Jh6Pt2/atKksMYQh94ZCoV3BYPCpaDS6qLu723UmlHu6urqIRqOLNE17qqGhYTdwr5khxc/WrVtpbW1tD4fDA5qm9Zro0M0FgvUtLS3L29raOqwQAEioqnomEonc3Nvbe94YUfz09PQQiURuVlX1TCWGmJ+2trYF8Xh8xYUiHQUMxWKxXqsbj8ViSxobG5+4UBhR/DQ0NPwiFostsdo+Ho/3Ya922PHAsBivqapqOVBMpVIzuVyugQsU+Xw+lEqlZmy0D1D5A6I5Z0jy1KlTmUQiYSkgSiaTI7quH9U0bfvdd9+tXCiM2LZtm6Jp2nZd148mk8kRK30SiUTf+Ph4Bvc/p7aPUCi0QNO01fF4fGk8Hq+qr4PB4H1+v39Pc3Pzhh07dijnS0UBRKPRDX6//4VgMHhfT09PNRXFvHnz+kOh0BpN0xY4SUNXTqfH4wlHIpEliqIo2Ww209TUNDI7O3tydHT0U+10XaexsfEiRVG2K4pyZS6X2x8IBJ5ZuXLlob179+bcPDzr1q3zHD58+PJUKnWToiiDGIXZD05PT58IBALFUoDf72+dnJzsArzZbDZ/7ty5t7LZ7LTT65oTdaEoSnc4HJ4PzObz+YDP58Pn882Oj4/nY7GYPjY2lurp6ZnNZDL9J06cWOvxeNbk83ldUZQ3VVU96PF4hpubm0fHxsaODwwM8OKL1j71GBoa4sCBA3R0dMyfmJhYkM1me3K53PJcLneZx+MJpNPpV9rb21/2+/1/Hx4e9re1tQXHx8cDsVhMSafT/kwmg6qqqVwuF5yenh7N5/NHXKfVBaDpvHLHEcH4/4x4ZV0Zycj2SrKuR1GU9kAgMJ5Opxu9Xu+UrutpIK+qhik0sh8ogUDAn8lkwj6fb0bX9Vg+n/8Ao0j6nxiXVJMyT17mSWJcZH1UYxrof4oh9TgkEUlIFjLFaUkUTjmQJDwv+C+rFX8UI69yPwAAAABJRU5ErkJggg==" alt="Logo" /></li>
  	<li class="breadcrumb-item">Digitale Probe</li>
    <li class="breadcrumb-item active">Hallo, {{session.firstname}}!</li>
    <li class="ml-auto"><a href="/deauth/">Logout</a></li>
  </ol>
</nav>
</header>

<style type="text/css">
	.playlist .controls header {
		background-color:#0062cc;
		text-align: left;
		padding-left: 0.4em;
    padding-bottom: 0.5em;
    line-height: 1.2em;
	}

  .playlist .controls label {
    margin-top:0.5em;
  }

  .playlist .controls .volume-slider { /*wat */
    font-size:7.5px;
    position:relative;
    top:-2px;
  }

  input[type=range]::-webkit-slider-thumb, input[type=range]::-moz-range-thumb {
    background: #0062cc !important;
  }

  .playlist {
    margin:0.5em 0 0 0;
  }

  #playlist {
    padding-right:10px;
    padding-left:0;
  }

  #lyrics-container{
    padding:0;
  }

  #lyrics {
    overflow:auto;
  }

	.btn-group-xs > .btn, .btn-xs {
	  padding: .25rem .4rem;
	  font-size: .875rem;
	  line-height: .5;
	  border-radius: .2rem;
	}

  .row {
    margin: 0;
  }

  .fa {
    line-height: inherit;
  }

  .emoji {
    font-family: apple color emoji,segoe ui emoji,noto color emoji,android emoji,emojisymbols,emojione mozilla,twemoji mozilla,segoe ui symbol;
  }
</style>



<div class="container">
  <div class="wrapper">
    <article class="post">
      <header class="post-header">
        <h1 class="post-title">Digitale Probe ‚Äì Musicollective</h1>
        <p class="lead">W√§hle ein St√ºck aus, dann kannst du die Lautst√§rke der Stimmen f√ºr ein optimales √úbe-Erlebnis einzeln regulieren. Viel Spa√ü beim Proben!</p>
      </header>
      <div class="post-content">
        <div id="top-bar" class="playlist-top-bar">
  <div class="playlist-toolbar">
  	<div class="btn-group" style="min-width:20em">
  	<select class="form-control select-songs" autocomplete="off">
  		<option value="-1" selected>St√ºck w√§hlen...</option>
  		{{#each song}}
  		<option value="{{@index}}">{{this}}</option>
  		{{/each}}
  	</select>
  	</div>
    <div class="btn-group">
      <span class="btn-pause btn btn-warning"><i class="fa fa-pause"></i></span>
      <span class="btn-play btn btn-success"><i class="fa fa-play"></i></span>
      <span class="btn-stop btn btn-danger"><i class="fa fa-stop"></i></span>
      <span class="btn-rewind btn btn-success"><i class="fa fa-fast-backward"></i></span>
      <span tabindex="0" class="btn-record btn btn-danger" data-toggle="popover" title="Tipps" data-placement="top" data-content="In einigen Browsern funktioniert die Aufnahmefunktion derzeit noch nicht. Um ein brauchbares Ergebnis zu erzielen, verwende Kopfh√∂rer, damit die restliche Musik nicht mit aufgenommen wird. Die Aufnahme beginnt bei der ausgew√§hlten Stelle, der Cursor l√§uft dabei nicht mit."><i class="fa fa-microphone"></i></span>
      <!--<span class="btn-fast-forward btn btn-success"><i class="fa fa-fast-forward"></i></span>-->
    </div>
    &nbsp;<span class="audio-pos">00:00:00.0</span>
    <!--<span class="loading-message" style="display:none">
    	&nbsp;&nbsp;<i class="fa fa-circle-o-notch fa-spin fa-fw"></i></i>Laden... <span class="loading-progress"></span>
    </span>-->&nbsp;
    <div id="loading-progress" class="progress" style="display:inline-block;width:192px;opacity:0;">
  	<div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">25%</div>
	</div>
  </div>
</div>
<div class="row">
  <div id="playlist" class="col-lg-7"></div>
  <div class="card col" id="lyrics-container" style="display:none;height:200px;">
    <div class="card-header">
      Liedtext
    </div>
    <div id="lyrics" class="card-body"></div>
  </div>
</div>
    </article>
    <footer class="small text-secondary"><!--Probleme? Schreib‚Äô eine <a href="mailto:lars@musicollective.de?subject=Digitale%20Probe">Mail an Lars</a> <span class="emoji">üôÇ</span>-->
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#feedbackModal">Feedback</button>
    </footer>


<!-- Feedback Modal -->
<div class="modal fade" id="feedbackModal" tabindex="-1" role="dialog" aria-labelledby="feedbackModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="feedbackModalLabel">Feedback</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Hast du Anregungen, Probleme oder Fragen? Hinterlass‚Äô uns hier eine Nachricht und wir kommen so schnell wie m√∂glich auf dich zur√ºck.</p>
        <form>
          <div class="form-group">
            <textarea class="form-control" id="message-text" placeholder="Deine Nachricht"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <span id="feedback-status"></span>
        <div class="spinner-border" id="feedback-spinner" style="display:none;"></div>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Schlie√üen</button>
        <button type="button" class="btn btn-primary" id="send-feedback">Absenden</button>
      </div>
    </div>
  </div>
</div>

<!-- Upload Modal -->
<div class="modal fade" id="uploadModal" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="uploadModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="uploadModalLabel">Aufnahme hochladen</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Du kannst deine Aufnahme hochladen, damit wir sie uns anh√∂ren k√∂nnen. Vorher solltest du sie nat√ºrlich auch selbst einmal abgespielt haben. Je nach Internetverbindung kann der Upload eine Weile dauern.</p>
        <div class="progress">
          <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" id="upload-progress" aria-valuemax="100">0%</div>
        </div>
      </div>
      <div class="modal-footer">
        <span id="upload-status"></span>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Abbrechen</button>
        <button type="button" class="btn btn-primary" id="send-track">Hochladen</button>
      </div>
    </div>
  </div>
</div>
  </div>
</div>

<script type="text/javascript" src="jquery/jquery.min.js"></script>
<script type="text/javascript" src="bootstrap/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript" src="bowser/es5.js"></script>
<script type="text/javascript" src="md/markdown-it.min.js"></script>
<script type="text/javascript" src="waveform-playlist/js/waveform-playlist.var.js"></script>

<script type="text/javascript">var resources = JSON.parse('{{{resources}}}');</script>

<script type="text/javascript">
  if (console.everything === undefined)
  {
    console.everything = [];

    console.defaultLog = console.log.bind(console);
    console.log = function(){
        console.everything.push("[log]" + Array.from(arguments));
        console.defaultLog.apply(console, arguments);
    }
    console.defaultError = console.error.bind(console);
    console.error = function(){
        console.everything.push("[error]" + Array.from(arguments));
        console.defaultError.apply(console, arguments);
    }
    console.defaultWarn = console.warn.bind(console);
    console.warn = function(){
        console.everything.push("[warn]" + Array.from(arguments));
        console.defaultWarn.apply(console, arguments);
    }
    console.defaultDebug = console.debug.bind(console);
    console.debug = function(){
        console.everything.push("[debug]" + Array.from(arguments));
        console.defaultDebug.apply(console, arguments);
    }
  }

  window.onerror = function(msg, src, lineno, colno, error) {
    $.post('/jserror', {
      data: {message: msg, source: src, lineno:lineno, stack:error.stack, ua:navigator.userAgent}
    });
  }

  $(function () {
    //if(bowser.getParser(window.navigator.userAgent).getPlatform().type == "desktop")
    $('.btn-record').popover({trigger: 'hover focus'});
    $('#send-feedback').click(sendFeedback);
    $('#send-track').click(upload);
  })
  var md = window.markdownit();
	var playlist = WaveformPlaylist.init({
	  samplesPerPixel: 5000,
	  waveHeight: 100,
	  container: document.getElementById("playlist"),
	  timescale: true,
	  state: 'cursor',
	  colors: {
	    waveOutlineColor: '#E0EFF1'
	  },
	  controls: {
	    show: true, //whether or not to include the track controls
	    width: 170 //width of controls in pixels
	  },
	  zoomLevels: [500, 1000, 3000, 5000],
  });

  var sendFeedback = function() {
    if($("#send-feedback").hasClass("disabled")) return;
    $("#feedback-spinner").show();
    $("#send-feedback").addClass("disabled");
    $.post('/feedback', {
      msg: $("#message-text").val(), 
      ua: navigator.userAgent, 
      con: JSON.stringify(console.everything)
    }, function(res){
      $("#feedback-spinner").hide();
      if(res == 'success') {
        setTimeout(() => {
          $("#feedbackModal").modal('hide');
          $("#feedback-status").empty();
          $("#message-text").val("");
          $("#send-feedback").removeClass("disabled");
        }, 1200);
        $("#feedback-status").text("Vielen Dank!");
      } else {
        $("#send-feedback").removeClass("disabled");
        $("#feedback-status").text("Fehler.")
      }
    });
  }

  function concatTypedArrays(a, b) { // a, b TypedArray of same type
      var c = new (a.constructor)(a.length + b.length);
      c.set(a, 0);
      c.set(b, a.length);
      return c;
    }

  var upload = function() {
    if($("#send-track").hasClass("disabled")) return;
    $("#send-track").addClass("disabled");
    $("#upload-status").empty();
    var t = uploadTrack.buffer;

    var oReq = new XMLHttpRequest();
    oReq.open("POST", "/upload", true);
    oReq.setRequestHeader("Content-Type", "application/octet-stream");
    oReq.setRequestHeader("X-Samplerate", t.sampleRate);
    oReq.setRequestHeader("X-Song", $(".select-songs option:selected").text());
    oReq.onload = function (oEvent) {
      $("#send-track").removeClass("disabled");
      console.log(oReq.response)
      if(oReq.response == '"ok"') {
        $("#uploadModal").modal("hide");
        $("#upload-progress").width("0%");
        $("#upload-progress").empty();
        //FIXME boy this is hacky...
        $(".playlist-tracks :nth-child("+(playlist.tracks.indexOf(uploadTrack)+1)+") .upload-btn").removeClass("btn-outline-dark").addClass("btn-outline-success");
      } else {
        $("#upload-status").text("Fehler beim Hochladen.");
      }
    };
    oReq.upload.onprogress = function(e) {

      if (e.lengthComputable) {
        $("#upload-progress").width((e.loaded / e.total) * 100 + "%");
        $("#upload-progress").text(Math.round(e.loaded / e.total * 100) + "%"); // Fallback for unsupported browsers.
      }
      if(e.loaded == e.total) $("#upload-progress").text("Verarbeiten...");
    };

    $('#uploadModal').on('hide.bs.modal', function (e) {
      oReq.abort();
      $("#upload-progress").width("0%");
      $("#upload-progress").empty();
      $("#send-track").removeClass("disabled");
    })

    var buf = t.getChannelData(0);
    oReq.send(buf);
  }
</script>
<script type="text/javascript" src="player.js"></script>